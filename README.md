# Скрипт для тестирования интернет-соединения (блокировки провайдера)

Этот скрипт на Python предназначен для проверки качества вашего интернет-соединения. Он помогает определить, вмешивается ли ваш интернет-провайдер в ваш трафик, в частности:

1.  **Не блокирует ли доступ к популярным хостингам** с помощью DPI (Deep Packet Inspection), что часто проявляется как обрыв загрузки на ~16-24 КБ.
2.  **Не нарушает ли работу современных протоколов шифрования**, таких как TLS 1.3, принудительно понижая версию до устаревшей TLS 1.2 или блокируя соединение.
3.  **Не производит ли блокировку по SNI**, когда блокируется не сам IP-адрес, а запрос к конкретному сайту на этом IP.

Скрипт имеет два режима работы: общий тест по списку популярных сервисов и ручной тест SNI + IP для продвинутых пользователей.

## Как это работает?

Скрипт выполняет три основных типа проверок.

### 1. Проверка на DPI (Deep Packet Inspection)

Некоторые провайдеры используют системы DPI для анализа и фильтрации трафика. Один из самых простых методов блокировки — разрыв TCP-соединения после передачи первых нескольких пакетов. Часто это происходит после загрузки примерно 16-24 КБ данных.

**Как это проверяет скрипт (`check_dpi`):**

1.  Он начинает скачивать большой файл с тестового сервера (`stream=True`), но не целиком, а по частям (чанками по 8 КБ).
2.  Он подсчитывает общий объем скачанных данных.
3.  **Результаты:**
    *   **`Not detected ✅`**: Если удалось скачать более 2 МБ данных (тест пройден) или если файл скачался полностью и его размер меньше этого порога.
    *   **`Detected❗️ (download stopped at X KB)`**: Если загрузка оборвалась и итоговый размер скачанной части попал в диапазон от 16 до 24 КБ. Это явный признак вмешательства DPI.
    *   **`Detected❗️ (Connection failed)`**: Если соединение не удалось установить в принципе (например, IP-адрес заблокирован).

### 2. Проверка версии TLS

TLS (Transport Layer Security) — это протокол, который обеспечивает шифрование между вашим компьютером и сервером (то, что делает `https` безопасным). Современная и наиболее безопасная версия — **TLS 1.3**. Некоторые провайдеры могут блокировать соединения по TLS 1.3 или принудительно понижать их до TLS 1.2, чтобы иметь возможность анализировать трафик.

**Как это проверяет скрипт (`check_tls_version`):**

1.  Скрипт пытается установить соединение с сервером, принудительно указав, какую версию TLS использовать: сначала `TLSv1_3`, затем `TLSv1_2`.
2.  Он не использует библиотеку `requests`, а работает на более низком уровне с помощью `socket` и `ssl` для полного контроля над параметрами TLS-рукопожатия.
3.  **Результаты:**
    *   **`OK ✅`**: Если соединение с указанной версией TLS успешно установлено.
    *   **`Blocked ❌`**: Если соединение не удалось установить (тайм-аут, ошибка SSL, сброс соединения). Это означает, что провайдер, скорее всего, блокирует попытки использовать данную версию TLS с этим сервером.

### 3. Проверка SNI + IP (для продвинутых пользователей)

Это самый сложный, но и самый интересный тест. Он помогает ответить на вопрос: "Блокируется ли IP-адрес целиком или только доступ к конкретному сайту на этом IP?"

**Что такое SNI?**
**SNI (Server Name Indication)** — это расширение протокола TLS. Когда вы подключаетесь к `https://google.com`, ваш браузер подключается к IP-адресу серверов Google. Но на одном IP-адресе могут "жить" сотни сайтов (`google.com`, `youtube.com`, `gmail.com`). Чтобы сервер понял, сертификат какого сайта вам нужно отдать, браузер в самом начале TLS-рукопожатия (еще до начала шифрования основного трафика) отправляет имя хоста (домен) в поле SNI.

Продвинутые системы блокировок могут "подсматривать" в это поле SNI и блокировать соединение, если там указан "запрещенный" домен, даже если сам IP-адрес находится в белом списке.

**Как это проверяет скрипт (`check_sni_ip`):**

1.  Вы вручную вводите **IP-адрес** (например, одного из серверов Cloudflare) и **SNI** (домен, который может быть заблокирован, но хостится на этом IP).
2.  Скрипт устанавливает прямое TCP-соединение с **IP-адресом**.
3.  При установке TLS-соединения он передает в поле **SNI** указанный вами домен. При этом он отключает проверку сертификата, так как сертификат будет выдан для домена (SNI), а не для IP-адреса, к которому мы подключились.
4.  Если TLS-рукопожатие проходит успешно, скрипт отправляет простейший HTTP-запрос и ждет ответа.
5.  **Результаты:**
    *   **`OK ✅`**: Если сервер ответил на HTTP-запрос. Это означает, что связка "IP + SNI" работает, и провайдер не блокирует трафик по имени домена в SNI.
    *   **`Blocked ❌`**: Если рукопожатие не удалось или сервер не ответил. Это может указывать на то, что провайдер обнаружил "запрещенный" домен в SNI и разорвал соединение.

Этот тест позволяет отделить блокировку по IP от более хитрой блокировки по имени сайта.

## Требования

*   Python 3.x
*   Библиотека `requests`

## Установка

1.  Склонируйте репозиторий или просто сохраните код в файл, например, `provider_test.py`.
2.  Установите необходимые зависимости:
    ```bash
    pip install requests
    ```

## Использование

Запустите скрипт из командной строки:

```bash
python provider_test.py
```

Вам будет предложено меню:

```
======================================
VPN/Провайдер тестер (v2.0)
======================================
1. Общий тест популярных хостингов (DPI + TLS 1.2/1.3)
2. Тест SNI + IP (ручной ввод)
0. Выход
Выберите пункт меню:
```

Пункт 1: Запускает автоматическую проверку по предустановленному списку сайтов, расположенных на хостингах Cloudflare, DigitalOcean, Hetzner и OVH.
Пункт 2: Переводит в режим ручного тестирования SNI+IP, где вам нужно будет ввести IP-адрес и домен (SNI) для проверки.
Пункт 0: Выход из программы.

Пример вывода общего теста

```
======================
Общий тест DPI и TLS
======================

[CF-02] Cloudflare (genshin.jmp.blue)
  DPI: Not detected ✅
  TLS 1.3: OK ✅
  TLS 1.2: OK ✅

[HE-02] Hetzner (ash-speed.hetzner.com)
  DPI: Detected❗️ (download stopped at 16 KB)
  TLS 1.3: Blocked ❌ (ConnectionResetError)
  TLS 1.2: OK ✅
```

## ВАЖНО:

Тест в своей работе подключается к реальным сайтам в подсетях указанных хостингов. Если вы считаете что тестовый сайт не работает (а такое может быть), выдает неверные результаты теста, или он не соответствует подсети - замените самостоятельно его в блоке `# --- Настройки тестов ---` на другой, более подходящий.

Не делайте поспешных выводов о блокировках по этому тесту, вполне может быть дело в конкретном сайте для теста. Если нужно уточнить результаты - замените тестовый сайт в скрипте на другой в той же подсети и у того же провайдера VPS

# Авторство

При разработке кода скрипта брался за основу репозиторий: https://github.com/hyperion-cs/dpi-checkers
